(function(f){f.support.touch="ontouchend" in document;if(!f.support.touch){return}var k=f.ui.mouse.prototype,h=k._mouseInit,g;function j(c,b){if(c.originalEvent.touches.length>1){return}c.preventDefault();var a=c.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,true,true,window,1,a.screenX,a.screenY,a.clientX,a.clientY,false,false,false,false,0,null);c.target.dispatchEvent(d)}k._touchStart=function(a){var b=this;if(g||!b._mouseCapture(a.originalEvent.changedTouches[0])){return}g=true;b._touchMoved=false;j(a,"mouseover");j(a,"mousemove");j(a,"mousedown")};k._touchMove=function(a){if(!g){return}this._touchMoved=true;j(a,"mousemove")};k._touchEnd=function(a){if(!g){return}j(a,"mouseup");j(a,"mouseout");if(!this._touchMoved){j(a,"click")}g=false};k._mouseInit=function(){var a=this;a.element.bind("touchstart",f.proxy(a,"_touchStart")).bind("touchmove",f.proxy(a,"_touchMove")).bind("touchend",f.proxy(a,"_touchEnd"));h.call(a)}})(jQuery);var currencyValue=0;var currencyChar="";var currencyFormat="";var BTCUnit=100000000;var BTCUnitDisplay={"100000000":"Ƀ","100000":"mɃ","100":"µɃ"};var currencySymbols={USD:"$"};function reload(){localStorage.setItem("currency","USD");if(!localStorage.getItem("currencyPrice")){localStorage.setItem("currencyPrice","avg")}if(!localStorage.getItem("currencyFormat")){localStorage.setItem("currencyFormat",",.")}if(!localStorage.getItem("BTCUnit")){localStorage.setItem("BTCUnit","100000000")}$("#btclist").empty();var c=localStorage.getItem("btcaddresses");if(c!==null){c=JSON.parse(c);var a="";$("#btclist").append('<li data-role="list-divider" data-theme="c"><div id="total_balance"></div></li>');for(var b in c){$("#btclist").append('<li id="'+c[b].address+'" data-theme="c" class="swipedelete"><a href="#details" onClick="showDetails(\''+c[b].address+'\')" data-transition="slide"><h2>'+c[b].label+"</h2><p>"+c[b].address+'</p><span class="ui-li-count ui-btn-up-c ui-btn-corner-all" id="btc_'+c[b].address+'"></span></a><span id="delete_'+c[b].address+'"></span></li>');a+=(a.length?"|":"")+c[b].address}$("#btclist").listview("refresh");$.mobile.loading("show");$.getJSON("bitstamp.php?currency="+localStorage.getItem("currency"),function(e){currencyValue=e.data[localStorage.getItem("currencyPrice")].value;currencyFormat=localStorage.getItem("currencyFormat");BTCUnit=parseInt(localStorage.getItem("BTCUnit"));BTCUnitRound=Math.log10(BTCUnit);var d="USD";currencyChar="USD";$("#footer").html("1 BTC "+BTCUnitDisplay[BTCUnit.toString()]+'   = <a href="#mtgox_info" style="color: #fff; text-decoration: none">'+currencyChar+" "+(currencySymbols[currencyChar]||currencyChar)+" "+(currencyValue*(BTCUnit/100000000)).toFixed(2)+"</a>");$.getJSON("http://blockchain.info/multiaddr?active="+a+"&cors=true",function(h){var g=0;var f=0;$.each(h.addresses,function(j,l){var k=(l.final_balance*currencyValue/100000000).formatMoney(2,currencyFormat.charAt(1),currencyFormat.charAt(0));f+=l.final_balance;g+=(l.final_balance*currencyValue/100000000);document.getElementById("btc_"+l.address).innerHTML=(k<0?"<font color='red'>":"")+(l.final_balance/BTCUnit).formatMoney(BTCUnitRound,currencyFormat.charAt(1),currencyFormat.charAt(0))+"<br/>"+(currencySymbols[currencyChar]||currencyChar)+" "+k+(k<0?"</font>":"")});$("#total_balance").html("Total: BTC "+BTCUnitDisplay[BTCUnit.toString()]+" "+(f/BTCUnit).formatMoney(BTCUnitRound,currencyFormat.charAt(1),currencyFormat.charAt(0))+" = "+currencyChar+" "+(currencySymbols[currencyChar]||currencyChar)+" "+g.formatMoney(2,currencyFormat.charAt(1),currencyFormat.charAt(0)));addSwipeEvents();$.mobile.loading("hide")})})}else{$("#btclist").append('<li data-theme="c"><a href="#popupAddAddress" data-transition="pop"><h2>No addresses found in local storage.</h2><p>Click on Add to add some addresses to watch</p></a></li>');$("#btclist").listview("refresh")}}function addAddress(){var b=JSON.parse(localStorage.getItem("btcaddresses"));if(b===null){b=[]}var a=document.getElementById("form_address").value;if(check_btc_address(a)){for(i in b){if(b[i].address==a){alert("You have already added this address");return false}}b.push({label:document.getElementById("form_label").value,address:a});localStorage.setItem("btcaddresses",JSON.stringify(b));$.mobile.changePage($("#main"),"none");document.getElementById("form_label").value="";document.getElementById("form_address").value="";reload()}else{alert("BTC address invalid")}}function removeAddress(a){if(!confirm("Are you sure you want to remove the address "+a+"?")){return false}var d=JSON.parse(localStorage.getItem("btcaddresses"));if(d!==null&&a!==undefined){var c=[];for(var b in d){if(d[b].address!==a){c.push(d[b])}}if(c.length){localStorage.setItem("btcaddresses",JSON.stringify(c))}else{localStorage.removeItem("btcaddresses")}reload()}}function showDetails(a){$("#detailsContent").empty();$("#footerDetails").html('<h3 class="ui-title" role="heading" aria-level="1">'+a+"</h3>");$.mobile.loading("show");$.getJSON("http://blockchain.info/multiaddr?active="+a+"&cors=true",function(e){if(e.txs.length){for(i in e.txs){var c=(e.txs[i].result*currencyValue/100000000);var d=(new Date(e.txs[i].time*1000)).toUTCString();var b='<li data-theme="c">';b+="<h2>"+e.txs[i].hash+"</h2>";b+="<p>"+(c<0?"<font color='red'>":"")+(e.txs[i].result/100000000).toFixed(8)+" - "+(currencySymbols[localStorage.getItem("currency")]||localStorage.getItem("currency"))+" "+c.formatMoney(2,currencyFormat.charAt(1),currencyFormat.charAt(0))+(c<0?"</font>":"")+"<br/>@ "+d+"</p>";b+="</li>";$("#detailsContent").append(b)}}else{$("#detailsContent").append('<li data-theme="c"><h2>No transactions found</h2></li>')}$("#detailsContent").listview("refresh");$.mobile.loading("hide")})}function updateMtGoxInfo(){$.mobile.loading("show");$.getJSON("mtgox.php?currency="+localStorage.getItem("currency"),function(a){var b=(new Date(parseInt(a.data.now)/1000)).toUTCString();out="Updated from Mt. Gox on "+b+"<br/>";out+='<table cellspacing="5" cellpadding="5">';out+="<tr><td><b>High</b></td><td>"+a.data.high.display+"</td></tr>";out+="<tr><td><b>Average</b></td><td>"+a.data.avg.display+"</td></tr>";out+="<tr><td><b>Low</b></td><td>"+a.data.low.display+"</td></tr>";out+="<tr><td><b>Volume</b></td><td>"+a.data.vol.display+"</td></tr>";out+="</table>";$("#mtgox_info_details").html(out);$.mobile.loading("hide")})}function loadOptions(){var b=localStorage.getItem("currency");if(!b){b="EUR"}$("#options_currency").val(b).prop("selected",true);var a=localStorage.getItem("currencyPrice");if(!a){a="avg"}$("#options_currency_price").val(a).prop("selected",true);var d=localStorage.getItem("currencyFormat");if(!d){d=",."}$("#options_currency_format").val(d).prop("selected",true);var c=localStorage.getItem("BTCUnit");if(!c){c="100000000"}$("#options_bitcoin_unit").val(c).prop("selected",true)}function saveOptions(){localStorage.setItem("currency",$("#options_currency").val());localStorage.setItem("currencyPrice",$("#options_currency_price").val());localStorage.setItem("currencyFormat",$("#options_currency_format").val());localStorage.setItem("BTCUnit",$("#options_bitcoin_unit").val())}function addSortable(){$("ul").addClass("ui-corner-top").removeClass("ui-corner-all").sortable({containment:"parent",opacity:0.6,update:function(a,b){a.preventDefault();alert("dropped");$("#btclist").listview("refresh")}})}function addSwipeEvents(){$(".swipedelete").bind("swipe",function(a){a.preventDefault();if(true||!a.currentTarget.children(".aDeleteBtn")[0]){$(".swipedelete").bind("tap click",function(c){c.preventDefault();$(".aDeleteBtn").remove();$(".swipedelete").unbind("tap click");return false});$(".aDeleteBtn").remove();var b=$("<a>Delete</a>").attr({"class":"aDeleteBtn ui-btn-up-r",onClick:"removeAddress("+a.currentTarget.id+")",id:a.currentTarget.id});$(a.currentTarget).prepend(b);$(".aDeleteBtn").bind("tap click",function(c){c.preventDefault();removeAddress(c.currentTarget.id)})}else{$(".aDeleteBtn").remove();$(".swipedelete").unbind("tap click")}})}Number.prototype.formatMoney=function(k,g,e){var h=this,k=isNaN(k=Math.abs(k))?2:k,g=g==undefined?".":g,e=e==undefined?",":e,f=h<0?"-":"",b=parseInt(h=Math.abs(+h||0).toFixed(k))+"",a=(a=b.length)>3?a%3:0;return f+(a?b.substr(0,a)+e:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(k?g+Math.abs(h-b).toFixed(k).slice(2):"")};Math.log10=function(a){return(Math.log(a))/(Math.log(10))};